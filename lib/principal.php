<?php
  /*
  * Desenvolvido por João "Keni" Artur
  *
  * https://www.joaoartur.com/
  * https://www.github.com/JoaoArtur/
  * https://anhax.team/
  */

  class anhax {
    public $comandos = null;

    private static function inicio() {
      $mensagem  = "\033[32m";
      $mensagem .= "# Desenvolvido por João 'Keni' Artur \n";
      $mensagem .= "# https://anhax.team/ \n";
      $mensagem .= "\033[0m";
      print($mensagem);
    }

    public static function arrayParaObjeto($array) {
      $objeto = new stdClass();
      foreach ($array as $key => $value) {
        $objeto->$key = $value;
      }
      return $objeto;
    }

    public static function verificarDependencias($cmd) {
      global $argv;
      if (isset(COMANDOS['comandos'][$cmd])) {
        if (isset(COMANDOS['comandos'][$cmd]['dependencia'])) {
          $dependencia = explode(',',COMANDOS['comandos'][$cmd]['dependencia']);
          $ok = false;
          foreach ($dependencia as $dep) {
            if (in_array($dep,$argv)) {
              $ok = true;
            }
          }
          if ($ok) {
            return true;
          } else {
            echo "\033[31m\nVerifique as dependências.\n\033[0m";
            return false;
            die;
          }
        } else {
          return false;
        }
      } else {
        return false;
      }
    }

    public function __construct() {
      self::inicio();
      $classe = COMANDOS['classe_principal'];
      include "lib/classes/$classe.class.php";
      $classe_principal = new $classe();

      global $argv;
      foreach ($argv as $arg_chave => $arg_valor) {
        $encontrado = false;
        foreach (COMANDOS['comandos'] as $cmd_chave => $cmd_valores) {
          if (!$encontrado) {
              if ($arg_valor == $cmd_chave || $arg_valor == $cmd_valores['alternativo']) {
                $encontrado = true;
                $acao = $cmd_valores['acao'];
                if (isset($cmd_valores['suargumento'])) {
                  $classe_principal->$acao();
                } else {
                  $classe_principal->$acao($argv[$arg_chave+1]);
                }
              }
          }
        }
      }
      if (!$encontrado) {
        $classe_principal->ajuda();
      }
    }

  }
?>
